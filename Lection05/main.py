import logging
from typing import Optional

from fastapi import FastAPI
from pydantic import BaseModel

logging.basicConfig(level=logging.INFO)

app = FastAPI()

logger = logging.getLogger(__name__)


# FastAPI –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞
#   —Å –ø–æ–º–æ—â—å—é –º–æ–¥—É–ª—è pydantic.
# –ö–ª–∞—Å—Å Item –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—è name, description, price –∏ tax.
# –ü–æ–ª—è name –∏ price –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã, –∞ –ø–æ–ª—è description –∏ tax –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.
# –ó–∞—Ç–µ–º –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞.
class Item(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    tax: Optional[float] = None


"""
@app.get("/")
# –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ GET-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ URL-–∞–¥—Ä–µ—Å–∞.
# –§—É–Ω–∫—Ü–∏—è read_root() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON-–æ–±—ä–µ–∫—Ç {"Hello": "World"}.
async def read_root():
    return {"Hello": "World"}
"""


@app.get("/")
# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ GET –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –∫–æ—Ä–Ω–µ–≤–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
async def read_root():
    logger.info('–û—Ç—Ä–∞–±–æ—Ç–∞–ª GET –∑–∞–ø—Ä–æ—Å.')
    return {"Hello": "World"}


@app.get("/items/{item_id}")
# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ GET –∑–∞–ø—Ä–æ—Å–∞ –ø–æ –ø—É—Ç–∏ "/items/{item_id}",
# –≥–¥–µ item_id ‚Äî —ç—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –ø—É—Ç–∏, –∞ q ‚Äî —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä –∑–∞–ø—Ä–æ—Å–∞.
# –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
async def read_item(item_id: int, q: str = None):
    return {"item_id": item_id, "q": q}


@app.post("/items/")
# POST –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö Item
# –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ POST-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è URL-–∞–¥—Ä–µ—Å–∞ /items/.
# –§—É–Ω–∫—Ü–∏—è create_item() –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç Item –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ –∂–µ.
async def create_item(item: Item):
    logger.info('–û—Ç—Ä–∞–±–æ—Ç–∞–ª POST –∑–∞–ø—Ä–æ—Å.')
    return item


@app.put("/items/{item_id}")
# PUT –∑–∞–ø—Ä–æ—Å, –∏—Å–ø–æ–ª—å–∑—É—è –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö Item
# –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ PUT-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è URL-–∞–¥—Ä–µ—Å–∞ /items/{item_id}.
# –§—É–Ω–∫—Ü–∏—è update_item() –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
# –∏ –æ–±—ä–µ–∫—Ç Item –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON-–æ–±—ä–µ–∫—Ç —Å —ç—Ç–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
async def update_item(item_id: int, item: Item):
    logger.info(f'–û—Ç—Ä–∞–±–æ—Ç–∞–ª PUT –∑–∞–ø—Ä–æ—Å –¥–ª—è item id = {item_id}.')
    return {"item_id": item_id, "item": item}


@app.delete("/items/{item_id}")
# –î–æ–±–∞–≤–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ DELETE-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è URL-–∞–¥—Ä–µ—Å–∞ /items/{item_id}.
# –§—É–Ω–∫—Ü–∏—è delete_item() –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞
# –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON-–æ–±—ä–µ–∫—Ç —Å —ç—Ç–∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º.
async def delete_item(item_id: int):
    logger.info(f'–û—Ç—Ä–∞–±–æ—Ç–∞–ª DELETE –∑–∞–ø—Ä–æ—Å –¥–ª—è item id = {item_id}.')
    return {"item_id": item_id}

# üî• –í–∞–∂–Ω–æ!
# –ó–∞—á–∞—Å—Ç—É—é –æ–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–µ —É–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö,
# –∞ –∏–∑–º–µ–Ω—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–µ –ø–æ–ª–µ is_deleted –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –ò—Å—Ç–∏–Ω–∞.
# –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã —Å–º–æ–∂–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–Ω–µ–µ —É–¥–∞–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
# –µ—Å–ª–∏ –æ–Ω –ø–µ—Ä–µ–¥—É–º–∞–µ—Ç —Å–ø—É—Å—Ç—è –≤—Ä–µ–º—è.
